sudo: required
services:
- docker
before_install:
- docker build -t $DOCKER_IMAGE .
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker push $DOCKER_IMAGE
script:
- docker run -it --rm $DOCKER_IMAGE py.test
- docker run -it --rm -e HALO_API_KEY=$HALO_API_KEY -e HALO_API_SECRET_KEY=$HALO_API_SECRET_KEY
  -e HALO_API_HOSTNAME=$HALO_API_HOSTNAME -e HALO_API_PORT=$HALO_API_PORT -e HALO_AGENT_KEY=$HALO_AGENT_KEY
  -e SERVER_GROUP=$SERVER_GROUP $DOCKER_IMAGE /app/scan_with_halo.sh
env:
  global:
  - SERVER_GROUP=dondash
  - HALO_API_HOSTNAME=api.cloudpassage.com
  - HALO_API_PORT=443
  - DOCKER_IMAGE="docker.io/berretterry/dondash"
  - secure: kHTO8w3cjM3cljUsrtAqZtWzYQFA//t6gb47P8ZHR5O/XIj3mPQ8TmzhMkTZXZMyejJkAmp2jWHqSe1qKuqtFChVflwJt5+l69nedl6xPHPR3s+y4SAHFRMDLAmwsYLwjA5k3v9CVxMOa2A7LeBd7bNoD8HNT0QAOMsOvToyb8DlTdHUDFHjKHNSZwGdTgosIKmUYWnABlWahbX45VN8ZjgFuFWmzgS0iu4s6iPVZ/yY7wagWn04wtSmFr04Hk7xXkct25ocVzhvQ8dIFoJHeaqhUq/EaWdx9p3NL3dPY1K/QV7BSrF5GtKmFgvJfPElDCIocsJMW60DEyEvRU/krH/7HDJXvWMi5H4cfS1bx4lnTZVLFFTk7O63QyRwpasmX4U1kAo7BvK95uDMB3m0ghqifVJXChA1NbTWJtwqO/uCnhnFry+KlqeI/ao8V7xDITKV8a79L+qMoyTOkJhH/wSw8JWY4J7GvOHJN9UIRwHP3pfE5KxBuZ5fux8HH8xlbKtviXv1jRBRupzbJDNiPobb9ZmIIdS0H7lN58Q/oB7K7XBBczzycyzKG3zlBx0Or6uhIIbC0cBoopL2cmOga37VnUDmbgNQYM8jeROkBs+x0ztvkxKhQz3oct6XvRjEgcQuXQuJlx48XXVC0vmzM3PAvwuYEoyYKU9/HOfhbM8=
  - secure: UA6LmwKJa6oMf1NNDd0fdG8JYfwZy8hNYFMVd6IanGgLPlOtR++00EgxdsNvtnuQzFLuG58/4ldUMaNyohztZwDiIAucRdQx6th5oDH1YFIzTtoJid3IySQoksHfo41QKxbcaorGhfYD9phVku61Azwqo5sl3l1zXoaRodrlzAl6wwuXu/m0tQCvKuXvJ4MzPCt/AdSGLvYDghdIoPXnCveEHUr7Vin2VCeaeMsyGXIJyYS705quRmRbfBIZwBx0U6hYiGVBLbKC5EQpGB1g6o03+1a4HiVW0FzKQDhD+Xd5PAUtUyKgVr93SKn11RZjMgC4To81IZvunrMlPFqrmoWzmmEVxSyHpTZ0DzQJquCZRz19BiMzXLYWAgGVbm7ZHyInGGXLnsBBwtEObe1auDmeL01cDA5WbSjzhXaW0pTR292NM39seQxxxegzMZSqaoJfl2T0sLc4xICZdIAKLiyAoBLCalddOMxZQtQB/TiuDnKmXbjjDQiP1N7NP3/mBmiQViSIrC/VRB85c6iapCIA0Ydc3RbPWuaM0iu4zG2tjmFtAthDd2bN4rYkpmuhQM6Gva54afnD4cxQABEvka0j48y+F0394lXW7hMk1WpLdxnCRWztkSA3/qMcIa7DRuHl8MpNH4UkQo7OuS/un/pjwgk//rRmLR7IKaXmaD8=
  - secure: G5fv6Xatr2QM19jXkl28vraJ0lKbJqPzoRxB+gKp7mVb+sjJBKGftZqWOtPh2I72hvukMX6gL2M8GHg/D24FoOnrfFBToqFyUCr6ENJ4WrYsvlBOR3Xq5bJRnzUxhGuZM7Kda6vbH5NtKB2lnFqOtjS2wbwu8JzOWZO793QP7ifMtzsiQWK9UbK4K/Oh8uNY7dP4v+qG3Bh+Jh6FSEPnFeYAhdKu2lkdffRcA7c7epvbgFKl6OMRbNAe5bR3QuhWOwXMpkMCp6VUXFj0FGecdIW0PbQ86ijHlhVL0MhYK1VfdMCkiKVXFvNk+C01QxNK7ZTOI+Bvz+2WfUZDgqtpq+Q4i1V8YmlD0T6gaL27YRDoLE4WGHGm/jll++2ryeCLfjPN4kK63CJI7Rm1UyNrWYgigCBcXnBTjWU9NEPTyzlQJjWn2rhCh1n4mAwrUrlwQR3s2B73gH04ym3evPtHJ92WZktD+sYYPjkJcHd3rBwb2RIsyuVzC8ugio0RxXNIw8zLZ/x+gx52T9NYbLI+/V81VU4/P/qNXngbL8sVKWF5JMdCi1byYwrcTG7ziLdefiNelJP9NJLpKBgCK98T0/nPBApSVIdpIuv72m/Kl69l8HOfdL6zxO8eNQJrQ6pgHs9SKjAmh38MI+sdCKfCei36bUdQhF9RX5DYu1V63GY=
  - secure: cY9PBS8wu9L0c7LD2DzJBTXmy6g71fOQ2H9aZUkK2nwHaHP09vZNVTZX9WMIMTZhTiE6EyG+6U8n8SonoJFAixPPo5vuLh4Xqul5Vq6A0HKWnig4FdaVmb3odyPZ9GntkSb72YoVBrQE/B2jIjUHZ1TtVN2/mL+ZdpgFE/ihLGC5OwpKydgNkieBAj3LwXsm1UotLbaRjchJwh9IktoAhsGMyIMFtX375u+mmstbCvuindQzlAAgTBI9pWCmKVnsSnU0lbyr4cG5XhOWMstg4GFLgdpyaKZxQq8gdhLS1FuheaGaxMtxCcKkKu5FlAVVnGs7Mk3PdEFQKlZGeelxjvYWXlDVu1fj1tKrvrubNMHXLIxIOCRu68YBhoZHP/qyxGOONimOAyXFa88fu4sWGdIRNmkJjHR039cMqgEGP4pCIE7H/00ar23YFX+amPKJ1fX8lo0FncejFJIT9tsGk7hsVVpkaulOpTZ3taIneTMBr2evWgeljOVYYWsEpBSloZStILKD+4SEab4u5+6b6qLzwCBh56P1qky6/TRBmO8hA0cpIoWFEC64/jhyaMpM65jj9u8bIwPe8oXr6ZkbsApP8AbaTtnkdUI+APbDtqmyY0NZJXVPmoN0qGQwPLJmLasv0p5Hp0cJQ0ZrBH8qGOEvAhdHOucIdD4mzAncQiQ=
  - secure: cY0Wv1Eta6drTkcW+JEvSNUskxrA3fBU9fK5AjUchrYNOmV5AkvCOG4eSBObfFlsQkPitrkXhnYWOGFpEDTECiYCFW/sYgCYMCzUGz+Z1Yu/RRRgnot5jn6BHhuHgjHUCNOCPeMahZFYW5rJYyti2jH0wlJJc1eca2rY+1f0O50dCGit3rvMhNdsptsasPeWyAb0eqPEbK9yuNH8HKOoNph4pscm/231TrutP0BqNLzpl3G9BsXZtqG/mJi8KWItUu7gFoPxtEDkDgyCoYD/QKu8YE7kOBlDb4IrTvN3UH2yoSplltmxaLuHc51eQDFSPUoX1SuisgFnV9fQUAKcHUuzqG55mBCpHe5BcSpKxvz1jk9hyogQ/IYGmXDzZ8Uq2ilVRy4OOwCdX20HKo3pJgSAGVcYfSb6gBj4gxehuyRye0q/cXgoVUa130lnHLXrDDbWiySouGJE3l6/1VbbTst3I+AyOYHvrYwxxgtT/BGPLbzltCcSOGQEpGrT0GzcIwudtCZS+qA67OrcveweIYLutSaDYWNVAdgHVALE9qV80WSSHPICjKq/HIAgqfmEbc3rFt6OtXJecmCM7KxRslIlr7MHFENn4cmvMK6ZABJPctsvOFU6bNMee4fMk4kMpHdBBAshudCwcT5PwIERPdqebB5Rt4fi3oWHDO+s+sE=
  - secure: dH3X/6y37RmRAhD17vr8rg4Jr1qaQ3QWmcyQyugJdUvaOQn+EFhNUEQzarRXJ2pCCR3xuiPVNvpsgbD6iPsK6lp4dhXKy0q7gZ+NJTfYEe6iqAPZsHFHAszTei0wMKjK1rJaMeWBpOe1g7SJ/8o7BAlUOVbBazq1tZ87PxeLYbHCzp1XGeFHLVmE80Jb9Cq5NP9K5r/u3zWDMjpUTaQvO/BIsJZl/02jAEePIxhDfPLaHaUysDi6ArX6taevY8nvNN0RhDi/+xyyIa2xyO01vpGIxZ+QoCaC2G8U+0C0Qb4HDiWK+nsqPWIHQkWaMVhYFKB5MImVaYwz48sl+t7l6Gp1e4TIeFDCegkQIE2mrv03/9vNM3sgeF4Gv+8wT5p289aaoQQfw6GApX4GcX0oqtXiIAsrfVTOE8EsNMq5zHr9QyyLyTpdNKn8xW/mE5EHKq213aOA2O8t8/eJuQQGkkdVKlLyse1gJpd4KwDg4FjwXM489vep8oOff20KmwoGFi8BXz7iBDNsc0u9cc7xvoFmg8osNUk71MusIJ9ynWnyKO5GEQxw6zw6yRNHkjoMfvz9OUVsf8A48YTbakYbj14Fv1nV1WIWQbgTXl8hwz3/ZlthiFr8NYq65+ZrJ1nGW7/iEYY2+W5z9TZSO07V6AmV3GUm9OnMBnqxKDNSDA8=
  - secure: JvfO9thjRTvzpsZkDIKVzfKhTgM/tou9oLmx8k6Ncj4yvygenUzQXROvvdtZjovGRAaQ2JnxXnE9PvfF9aV8X59OTjh90E3LMGZbRY/LibwnvsgCHqD3ruZVpz8VgzwlGAmXFoz4DZ+M4uZT4IbTd/nEnkO3KuTTt8tZhtkJv0hu6LlKnwKTqqCBqeyvnTD5NL5WWwQXmbWHTm5x6NAjntzHggMa1a/OCvvao+1/ELmkou7yrz4rHu/EEygqAhhEfDOvAidgZAop6Ea4IHK/Y9HYNmWnsVs/NYTbOk9Bgu87feLorxy+7xffrKCsgHwkYEWHu4TTJM1TPz/CuTt5DLXuDLs0FlrLmRD6bo6oCKAb3ETrtvE1BXHv24Iuy0udoMwDZQzj9eX9yVRI+JnieaEICuytbie1LvzQ+M/6utxBIOyc3qA2yZTqQqnG5oDGhWsCLx0S1O6OrLtoAkKvnFGe1uLF5WaY4AvYyp/Ofx/AYnirfiKKV8tqsmiGOjwtes2N8CcdsxzIwrSpRC8S22XqXo8CV6opajynHYJPzbtFSffZw5CoIh2ieThVHXjxKbPom8egMed3hlluXq4UquDEkcaf7oEMP3HXOZrQeeeJ0ehpjldW3LG8IoiUoIZxo4SJ18JzmwG6/WSiASjblxTpeZ2bClbqjiDREsPZj/k=
